namespace = Infect

country_event = {
    id = Infect.1

    is_triggered_only = yes
    hide_window = yes

    trigger = {
        owner = {
            has_origin = origin_hive_infestor
        }
    }
    immediate = {
		give_technology = { message = no tech = tech_mine_volatile_motes }
		give_technology = { message = no tech = tech_mine_exotic_gases }
		give_technology = { message = no tech = tech_mine_rare_crystals }
        random_owned_planet = {
            limit = { is_capital = yes }
            set_planet_size = 20
			set_planet_flag = swarm_heart
			
			while = {
				count = 2
				create_pop = {
					species = owner_main_species
					ethos = random
				}
			}
        }
    }
}

country_event = { # gatherer's death
    id = Infect.2

    hide_window = yes
	
	mean_time_to_happen = {
		years = 2
	}

    trigger = {
        owner = {
			NOT = {
				has_origin = origin_hive_infestor
			}
        }
		any_planet_within_border = {
			OR = {
				has_planet_flag = infested@from
				is_planet_class = pc_bio_organ
				is_planet_class = pc_bio_organ_broken
			}
		}
    }
    immediate = {
        every_planet_within_border = { 
			limit = { 
				OR = {
					has_planet_flag = infested@from
					is_planet_class = pc_bio_organ
					is_planet_class = pc_bio_organ_broken
				}
			}
			change_pc = pc_broken
			set_planet_entity = {
				entity = "shattered_infected_planet"
			}
			clear_deposits = yes
		}
    }
}

pop_event = {
	id = Infect.3
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { 
				has_trait = trait_pc_hive_preference
				NOT = { has_trait = trait_infestor_drone_1 }
				from = { is_planet_class = pc_hive }
				owner = {
					has_origin = origin_hive_infestor
				}
			}
			modify_species = {
				species = this
				remove_trait = trait_infestor_drone_2
				add_trait = trait_infestor_drone_1
			}
		}
		else_if = {
			limit = {
				has_trait = trait_infestor_drone_1
				from = {
					NOT = { 
						is_planet_class = pc_hive 
					}
				}
			}
			modify_species = {
				species = this
				remove_trait = trait_infestor_drone_1
				add_trait = trait_infestor_drone_2
			}
		}
	}
}